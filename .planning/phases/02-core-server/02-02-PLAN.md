---
phase: 02-core-server
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/mcpp/server/resource_registry.h
  - src/mcpp/server/resource_registry.cpp
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Library consumer can register resources with URI and MIME type"
    - "Library consumer can call resources/list and receive resource discovery metadata"
    - "Library consumer can read resources via resources/read"
    - "Resources support text content (TextResourceContents)"
    - "Resources support binary/blob content (BlobResourceContents with base64)"
  artifacts:
    - path: "src/mcpp/server/resource_registry.h"
      provides: "Resource registration and serving with text/blob content types"
      min_lines: 60
      contains: "class ResourceRegistry", "struct ResourceRegistration", "using ResourceHandler"
  key_links:
    - from: "src/mcpp/server/resource_registry.h"
      to: "src/mcpp/server/tool_registry.h"
      via: "Similar handler registration pattern"
      pattern: "using.*Handler|struct.*Registration"
---

<objective>
Implement resource registration, discovery, and serving with text and blob content support.

Purpose: Resources enable servers to expose data (files, artifacts, computed values) to clients. Resource discovery (resources/list) and reading (resources/read) are core server capabilities. Support for both text and binary content (base64-encoded) covers common use cases.

Output: Working resource registry with registration, discovery, and reading; support for TextResourceContents and BlobResourceContents; URI-based registration.
</objective>

<execution_context>
@/home/kotdath/.claude/get-shit-done/workflows/execute-plan.md
@/home/kotdath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-server**---tools,-resources,-prompts-with-stdio-transport-and-progress-support/02-CONTEXT.md
@.planning/phases/02-core-server**---tools,-resources,-prompts-with-stdio-transport-and-progress-support/02-RESEARCH.md
@src/mcpp/core/json_rpc.h
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create resource content types and handler signatures</name>
  <files>src/mcpp/server/resource_registry.h</files>
  <action>
Create src/mcpp/server/resource_registry.h with:

1. Include guards and includes:
   - #include <nlohmann/json.hpp>
   - #include <functional>
   - #include <string>
   - #include <unordered_map>
   - #include <optional>
   - #include <vector>

2. namespace mcpp::server

3. Resource content result type (following RESEARCH.md "Resource Read Handler" example):
   ```cpp
   struct ResourceContent {
       std::string uri;
       std::optional<std::string> mime_type;

       bool is_text = true;
       std::string text;      // For text content
       std::string blob;      // For binary content (base64)
   };
   ```

4. Resource handler signature:
   ```cpp
   using ResourceHandler = std::function<ResourceContent(const std::string& uri)>;
   ```

5. Resource registration struct:
   ```cpp
   struct ResourceRegistration {
       std::string uri;
       std::string name;
       std::optional<std::string> description;
       std::string mime_type;
       ResourceHandler handler;
   };
   ```

Follow CONTEXT.md "Resource serving" decisions exactly. URI scheme is agnostic - user decides what schemes to support.
MIME type is declared at registration.
  </action>
  <verify>grep -E "struct ResourceContent|struct ResourceRegistration|using ResourceHandler" src/mcpp/server/resource_registry.h</verify>
  <done>resource_registry.h defines ResourceContent with text/blob support, ResourceRegistration with URI and MIME type, and ResourceHandler function type</done>
</task>

<task type="auto">
  <name>Task 2: Create ResourceRegistry class with registration and reading</name>
  <files>src/mcpp/server/resource_registry.h src/mcpp/server/resource_registry.cpp</files>
  <action>
Extend resource_registry.h and create resource_registry.cpp with:

1. In resource_registry.h, add ResourceRegistry class:
   ```cpp
   class ResourceRegistry {
   public:
       // Register a resource
       bool register_resource(
           const std::string& uri,
           const std::string& name,
           const std::optional<std::string>& description,
           const std::string& mime_type,
           ResourceHandler handler
       );

       // List all registered resources
       std::vector<nlohmann::json> list_resources() const;

       // Read a resource by URI
       std::optional<nlohmann::json> read_resource(const std::string& uri) const;

       // Check if resource exists
       bool has_resource(const std::string& uri) const;

   private:
       std::unordered_map<std::string, ResourceRegistration> resources_;
   };
   ```

2. In resource_registry.cpp, implement methods:
   - register_resource: Store in resources_ map with URI as key
   - list_resources: Return array of resource objects with uri, name, optional description, mimeType
   - read_resource:
     * Find resource by URI
     * Call handler to get ResourceContent
     * Convert to MCP ReadResourceResult format:
       ```json
       {
         "contents": [{
           "uri": "...",
           "mimeType": "...",
           "type": "resource",
           "text": "..."  // OR "blob": "..."
         }]
       }
       ```
     * Return std::nullopt if URI not found
   - has_resource: Check if URI exists

Use ResourceContent::is_text to choose text vs blob field in output.
  </action>
  <verify>grep -E "class ResourceRegistry|register_resource|list_resources|read_resource|has_resource" src/mcpp/server/resource_registry.h src/mcpp/server/resource_registry.cpp</verify>
  <done>ResourceRegistry provides register_resource, list_resources, read_resource, has_resource with URI-based lookup and MCP-compliant response format</done>
</task>

</tasks>

<verification>
- resource_registry.h defines ResourceContent with is_text flag for text vs blob
- ResourceRegistry::register_resource stores URI as key with handler
- ResourceRegistry::list_resources returns array with uri, name, optional description, mimeType
- ResourceRegistry::read_resource returns contents array with proper text vs blob field selection
- Binary content is stored as string (base64 encoding is caller's responsibility)
</verification>

<success_criteria>
Resource registry supports registration, discovery, and reading.
Resources return proper MCP ReadResourceResult format with contents array.
Text resources use "text" field; blob resources use "blob" field.
URI-based lookup enables any URI scheme (file://, custom://, etc.).
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-server/02-02-SUMMARY.md`
</output>
