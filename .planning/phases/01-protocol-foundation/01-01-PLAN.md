---
phase: 01-protocol-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/mcpp/core/json_rpc.h
  - src/mcpp/core/json_rpc.cpp
  - src/mcpp/core/error.h
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Library consumer can create a JSON-RPC request with method name and params"
    - "Library consumer can serialize a request to JSON string"
    - "Library consumer can parse a JSON-RPC response from JSON string"
    - "Library consumer can create a JSON-RPC error with code and message"
    - "Request ID type supports both numeric and string IDs"
    - "JSON-RPC error follows spec with PARSE_ERROR, INVALID_REQUEST, METHOD_NOT_FOUND, INVALID_PARAMS, INTERNAL_ERROR"
  artifacts:
    - path: "src/mcpp/core/json_rpc.h"
      provides: "JSON-RPC 2.0 message types (Request, Response, Notification)"
      min_lines: 80
      contains: "struct JsonRpcRequest", "struct JsonRpcResponse", "struct JsonRpcNotification", "using RequestId"
    - path: "src/mcpp/core/error.h"
      provides: "JSON-RPC error codes and error type"
      min_lines: 40
      contains: "constexpr int PARSE_ERROR", "constexpr int INVALID_REQUEST", "struct JsonRpcError"
  key_links:
    - from: "src/mcpp/core/json_rpc.h"
      to: "nlohmann/json"
      via: "include <nlohmann/json.hpp>"
      pattern: "#include.*nlohmann/json"
    - from: "src/mcpp/core/json_rpc.cpp"
      to: "src/mcpp/core/json_rpc.h"
      via: "implementation of from_json and to_json methods"
      pattern: "JsonValue.*to_json|from_json"
---

<objective>
Implement JSON-RPC 2.0 core message types (Request, Response, Notification) with nlohmann/json serialization and standard error codes.

Purpose: All MCP communication is JSON-RPC 2.0; these types are the foundation for every message exchanged between client and server.
Output: Working JsonRpcRequest, JsonRpcResponse, JsonRpcNotification, JsonRpcError types with to_json/from_json methods.
</objective>

<execution_context>
@/home/kotdath/.claude/get-shit-done/workflows/execute-plan.md
@/home/kotdath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-protocol-foundation/01-CONTEXT.md
@.planning/phases/01-protocol-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create JSON-RPC 2.0 message types header</name>
  <files>src/mcpp/core/json_rpc.h</files>
  <action>
Create src/mcpp/core/json_rpc.h with:

1. Include guards and nlohmann/json include
2. namespace mcpp::core
3. using RequestId = std::variant<int64_t, std::string>
4. using JsonValue = nlohmann::json
5. struct JsonRpcRequest with fields:
   - std::string jsonrpc = "2.0"
   - RequestId id
   - std::string method
   - JsonValue params (default nullptr)
   - JsonValue to_json() const method
6. struct JsonRpcResponse with fields:
   - std::string jsonrpc = "2.0"
   - RequestId id
   - std::optional<JsonValue> result
   - std::optional<JsonRpcError> error
   - static std::optional<JsonRpcResponse> from_json(const JsonValue& j)
7. struct JsonRpcNotification with fields:
   - std::string jsonrpc = "2.0"
   - std::string method
   - JsonValue params
   - JsonValue to_json() const method

Follow RESEARCH.md Pattern 1 exactly. Use std::visit for RequestId serialization.
Do NOT add any MCP-specific types yet (those are in a later plan).
  </action>
  <verify>grep -E "struct JsonRpc(Request|Response|Notification)|using RequestId|std::variant" src/mcpp/core/json_rpc.h</verify>
  <done>json_rpc.h compiles and defines RequestId, JsonRpcRequest, JsonRpcResponse, JsonRpcNotification with to_json methods</done>
</task>

<task type="auto">
  <name>Task 2: Create JSON-RPC error types</name>
  <files>src/mcpp/core/error.h</files>
  <action>
Create src/mcpp/core/error.h with:

1. Include guards and nlohmann/json include
2. namespace mcpp::core
3. Standard JSON-RPC error code constants (constexpr int):
   - PARSE_ERROR = -32700
   - INVALID_REQUEST = -32600
   - METHOD_NOT_FOUND = -32601
   - INVALID_PARAMS = -32602
   - INTERNAL_ERROR = -32603
4. struct JsonRpcError with fields:
   - int code
   - std::string message
   - std::optional<JsonValue> data
   - JsonValue to_json() const method
   - static std::optional<JsonRpcError> from_json(const JsonValue& j)

Follow RESEARCH.md "JSON-RPC Error Handling" code example exactly.
  </action>
  <verify>grep -E "PARSE_ERROR|INVALID_REQUEST|struct JsonRpcError" src/mcpp/core/error.h</verify>
  <done>error.h defines all JSON-RPC error code constants and JsonRpcError struct with to_json/from_json</done>
</task>

<task type="auto">
  <name>Task 3: Implement JSON-RPC parsing and serialization</name>
  <files>src/mcpp/core/json_rpc.cpp</files>
  <action>
Create src/mcpp/core/json_rpc.cpp with:

1. Include json_rpc.h and error.h
2. Implement JsonRpcResponse::from_json():
   - Parse jsonrpc field (must be "2.0")
   - Parse id field (handles both int and string)
   - Parse result OR error field (mutually exclusive)
   - Return std::nullopt if parsing fails
3. Implement JsonRpcError::from_json():
   - Parse code and message (required)
   - Parse data (optional)
   - Return std::nullopt if parsing fails
4. Implement to_json() methods for Request and Notification

Use nlohmann::json's exception handling (nlohmann::json::exception) for parse errors.
Return std::nullopt when required fields are missing or types don't match.
  </action>
  <verify>grep -E "from_json|to_json|std::optional" src/mcpp/core/json_rpc.cpp</verify>
  <done>json_rpc.cpp implements from_json for Response and Error, validates required fields, handles JSON parse exceptions</done>
</task>

</tasks>

<verification>
- json_rpc.h and error.h compile without errors
- All structs have proper to_json() methods
- Response and Error have from_json() static methods
- RequestId uses std::variant<int64_t, std::string>
- Error codes match JSON-RPC 2.0 spec
</verification>

<success_criteria>
JSON-RPC 2.0 core types are fully defined and can serialize/deserialize valid JSON-RPC messages.
Request supports numeric and string IDs.
Error includes all standard JSON-RPC error codes.
</success_criteria>

<output>
After completion, create `.planning/phases/01-protocol-foundation/01-01-SUMMARY.md`
</output>
