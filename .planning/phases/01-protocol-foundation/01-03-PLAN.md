---
phase: 01-protocol-foundation
plan: 03
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/mcpp/protocol/types.h
  - src/mcpp/protocol/capabilities.h
  - src/mcpp/protocol/initialize.h
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Library consumer can declare client capabilities (tools, resources, prompts, etc.)"
    - "Library consumer can declare server capabilities (tools, resources, prompts, etc.)"
    - "Library consumer can create an initialize request with protocol version and capabilities"
    - "Library consumer can parse an initialize response with server capabilities"
    - "Capability structures support nested sub-capabilities (e.g., ToolCapability.listChanged)"
    - "Protocol version negotiation is supported (protocolVersion field)"
  artifacts:
    - path: "src/mcpp/protocol/types.h"
      provides: "MCP protocol base types (Implementation, RequestMeta)"
      min_lines: 30
      contains: "struct Implementation", "struct RequestMeta"
    - path: "src/mcpp/protocol/capabilities.h"
      provides: "Client and server capability structures"
      min_lines: 80
      contains: "struct ClientCapabilities", "struct ServerCapabilities", "struct ToolCapability"
    - path: "src/mcpp/protocol/initialize.h"
      provides: "Initialize/initialized message types"
      min_lines: 50
      contains: "struct InitializeRequestParams", "struct InitializeResult", "constexpr const char PROTOCOL_VERSION"
  key_links:
    - from: "src/mcpp/protocol/initialize.h"
      to: "src/mcpp/core/json_rpc.h"
      via: "Initialize request is a JsonRpcRequest with initialize method"
      pattern: "JsonRpcRequest|method.*initialize"
    - from: "src/mcpp/protocol/capabilities.h"
      to: "thirdparty/modelcontextprotocol/schema/2025-11-25/schema.ts"
      via: "Capability structures match MCP spec exactly"
      pattern: "struct.*Capability|struct Experimental"
---

<objective>
Define MCP protocol types: capabilities (client/server), initialize/initialized handshake messages, and protocol version negotiation.

Purpose: MCP requires specific capability structures and a defined initialization handshake before any other operations can proceed.
Output: Complete capability types matching MCP 2025-11-25 schema and initialize message structures.
</objective>

<execution_context>
@/home/kotdath/.claude/get-shit-done/workflows/execute-plan.md
@/home/kotdath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-protocol-foundation/01-CONTEXT.md
@.planning/phases/01-protocol-foundation/01-RESEARCH.md
@thirdparty/modelcontextprotocol/schema/2025-11-25/schema.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define base MCP types</name>
  <files>src/mcpp/protocol/types.h</files>
  <action>
Create src/mcpp/protocol/types.h with:

1. Include guards, <optional>, <string>
2. namespace mcpp::protocol
3. struct Implementation with:
   - std::string name
   - std::string version
4. struct RequestMeta with:
   - std::optional<std::string> progressToken
   - std::optional<std::string> mimeType

These are referenced by initialize messages and other MCP types.
Follow MCP 2025-11-25 schema.ts "Implementation" and "RequestMeta" definitions.
  </action>
  <verify>grep -E "struct Implementation|struct RequestMeta" src/mcpp/protocol/types.h</verify>
  <done>types.h defines Implementation and RequestMeta structures</done>
</task>

<task type="auto">
  <name>Task 2: Define MCP capability structures</name>
  <files>src/mcpp/protocol/capabilities.h</files>
  <action>
Create src/mcpp/protocol/capabilities.h with:

1. Include guards, types.h, <optional>
2. namespace mcpp::protocol
3. Define capability structs matching MCP 2025-11-25 schema:

ClientCapabilities:
  - std::optional<CapabilitySet> experimental
  - std::optional<RootsCapability> roots
  - std::optional<SamplingCapability> sampling

ServerCapabilities:
  - std::optional<CapabilitySet> experimental
  - std::optional<LoggingCapability> logging
  - std::optional<PromptCapability> prompts
  - std::optional<ResourceCapability> resources
  - std::optional<ToolCapability> tools

Individual capability types (nested sub-capabilities):
  - struct ToolCapability { std::optional<bool> listChanged; }
  - struct ResourceCapability { bool subscribe = false; std::optional<bool> listChanged; }
  - struct PromptCapability { std::optional<bool> listChanged; }
  - struct RootsCapability { std::optional<bool> listChanged; }
  - struct SamplingCapability { }
  - struct LoggingCapability { }

4. struct CapabilitySet as nlohmann::json (experimental capabilities are arbitrary JSON)

Reference thirdparty/modelcontextprotocol/schema/2025-11-25/schema.ts for exact structure.
  </action>
  <verify>grep -E "struct.*Capabilities|struct ToolCapability|struct ResourceCapability|struct PromptCapability" src/mcpp/protocol/capabilities.h</verify>
  <done>capabilities.h defines all client and server capability structures with nested sub-capabilities</done>
</task>

<task type="auto">
  <name>Task 3: Define initialize/initialized handshake types</name>
  <files>src/mcpp/protocol/initialize.h</files>
  <action>
Create src/mcpp/protocol/initialize.h with:

1. Include guards, types.h, capabilities.h, core/json_rpc.h
2. namespace mcpp::protocol
3. constexpr const char* PROTOCOL_VERSION = "2025-11-25"
4. struct InitializeRequestParams:
   - std::string protocolVersion
   - ClientCapabilities capabilities
   - Implementation clientInfo
   - std::optional<RequestMeta> _meta
5. struct InitializeResult:
   - std::string protocolVersion
   - ServerCapabilities capabilities
   - Implementation serverInfo
   - std::optional<std::string> instructions
6. struct InitializedNotificationParams:
   (empty struct - no fields required)
7. Helper functions:
   - JsonRpcRequest make_initialize_request(const InitializeRequestParams& params)
   - bool validate_protocol_version(std::string_view version)

Follow RESEARCH.md "MCP Initialization Handshake" example.
Protocol version validation should check if returned version is supported (exact match for now).
  </action>
  <verify>grep -E "PROTOCOL_VERSION|InitializeRequestParams|InitializeResult|make_initialize_request" src/mcpp/protocol/initialize.h</verify>
  <done>initialize.h defines initialize request/response types and handshake helper functions</done>
</task>

</tasks>

<verification>
- All capability structs match MCP 2025-11-25 schema
- PROTOCOL_VERSION is set to "2025-11-25"
- InitializeRequestParams has protocolVersion, capabilities, clientInfo
- InitializeResult has protocolVersion, capabilities, serverInfo
- make_initialize_request creates a valid JsonRpcRequest
- validate_protocol_version checks version string
</verification>

<success_criteria>
MCP protocol types for initialization handshake are fully defined.
Client and server can exchange capabilities during initialize.
Protocol version can be negotiated.
</success_criteria>

<output>
After completion, create `.planning/phases/01-protocol-foundation/01-03-SUMMARY.md`
</output>
