---
phase: 10-automated-cli-testing
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .gitmodules
  - tests/cli/bats
  - tests/cli/test_helper/bats-support
  - tests/cli/test_helper/bats-assert
  - tests/cli/test_helper/bats-file
  - tests/cli/test_helper/common-setup.sh
autonomous: true

must_haves:
  truths:
    - "Git submodules for bats-core and helper libraries are added and initialized"
    - "common-setup.sh loads bats-support, bats-assert, bats-file helpers"
    - "PATH is configured to find inspector_server in build/examples"
    - "MCPP_DEBUG environment variable is set for test execution"
  artifacts:
    - path: "tests/cli/bats"
      provides: "bats-core testing framework (Git submodule)"
    - path: "tests/cli/test_helper/bats-support"
      provides: "bats-support helper library (Git submodule)"
    - path: "tests/cli/test_helper/bats-assert"
      provides: "bats-assert assertion library (Git submodule)"
    - path: "tests/cli/test_helper/bats-file"
      provides: "bats-file filesystem assertions (Git submodule)"
    - path: "tests/cli/test_helper/common-setup.sh"
      provides: "Common setup function for all test files"
      min_lines: 20
    - path: ".gitmodules"
      provides: "Git submodule configuration"
      contains: "bats-core"
  key_links:
    - from: "tests/cli/test_helper/common-setup.sh"
      to: "tests/cli/test_helper/bats-support/load"
      via: "load 'test_helper/bats-support/load'"
    - from: "tests/cli/test_helper/common-setup.sh"
      to: "build/examples/inspector_server"
      via: "PATH configuration"
---

<objective>
Set up bats-core testing infrastructure with Git submodules and common setup helper.

Purpose: Provide the foundation for CLI testing by installing bats-core and helper libraries as Git submodules, and creating a common setup function that all test files will use. This ensures reproducible builds and consistent test environment configuration.

Output: tests/cli/ directory with bats-core framework, helper libraries, and common-setup.sh
</objective>

<execution_context>
@/home/kotdath/.claude/get-shit-done/workflows/execute-plan.md
@/home/kotdath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-automated-cli-testing/10-RESEARCH.md
@.planning/phases/09-inspector-server-integration/09-03-SUMMARY.md

# Prior Phase Summary Reference
Phase 09-03 completed inspector_server.cpp with:
- MCP stdio transport (Content-Length headers)
- Full MCP protocol support (tools, resources, prompts)
- JSON-RPC request validation
- examples/mcp.json configuration

This infrastructure will test the server built in Phase 9.
</context>

<tasks>

<task type="auto">
  <name>Set up bats-core Git submodules and directory structure</name>
  <files>
    .gitmodules
    tests/cli/bats
    tests/cli/test_helper/bats-support
    tests/cli/test_helper/bats-assert
    tests/cli/test_helper/bats-file
    tests/cli/test_helper/common-setup.sh
  </files>
  <action>
    Create the bats-core testing infrastructure:

    1. Create tests/cli directory structure:
       ```bash
       mkdir -p tests/cli/test_helper
       ```

    2. Add Git submodules for bats-core and helper libraries:
       ```bash
       git submodule add https://github.com/bats-core/bats-core.git tests/cli/bats
       git submodule add https://github.com/bats-core/bats-support.git tests/cli/test_helper/bats-support
       git submodule add https://github.com/bats-core/bats-assert.git tests/cli/test_helper/bats-assert
       git submodule add https://github.com/bats-core/bats-file.git tests/cli/test_helper/bats-file
       ```

    3. Initialize and update submodules:
       ```bash
       git submodule update --init --recursive
       ```

    4. Create tests/cli/test_helper/common-setup.sh with:
       - _common_setup() function that loads all helper libraries
       - PROJECT_ROOT derived from $BATS_TEST_FILENAME
       - PATH configuration to include build/examples
       - MCPP_DEBUG=1 export for server debug output
       - BATS_TEST_TMPDIR for temporary files

       Reference RESEARCH.md Pattern 1 for exact structure.

    5. Make common-setup.sh executable:
       ```bash
       chmod +x tests/cli/test_helper/common-setup.sh
       ```

    DO NOT install bats-core via system package manager (apt, brew) - use Git submodules only for reproducibility.
    DO NOT modify existing tests/ directory structure (unit, integration remain unchanged).
  </action>
  <verify>
    1. Verify .gitmodules contains entries for all 4 submodules
    2. Verify each submodule directory exists and contains files (not empty)
    3. Verify common-setup.sh is executable: `ls -la tests/cli/test_helper/common-setup.sh`
    4. Verify common-setup.sh contains _common_setup function
    5. Verify `git status` shows new submodule references
  </verify>
  <done>
    - Git submodules added for bats-core, bats-support, bats-assert, bats-file
    - common-setup.sh created with helper loading and PATH configuration
    - `git submodule status` shows all submodules initialized
  </done>
</task>

</tasks>

<verification>
After completing this plan:
1. `ls tests/cli/bats/bin/bats` should exist (bats executable)
2. `ls tests/cli/test_helper/bats-support/load.bash` should exist
3. `cat tests/cli/test_helper/common-setup.sh | grep _common_setup` should show the function
4. `grep -c "submodule" .gitmodules` should return 4 (four submodules)
</verification>

<success_criteria>
1. All 4 Git submodules are added and initialized (bats-core, bats-support, bats-assert, bats-file)
2. common-setup.sh provides _common_setup() function with helper loading
3. PATH is configured to find build/examples/inspector_server
4. No system package dependencies (all bats tools via Git submodules)
</success_criteria>

<output>
After completion, create `.planning/phases/10-automated-cli-testing/10-01-SUMMARY.md`
</output>
