---
phase: 10-automated-cli-testing
plan: 03
type: execute
wave: 2
depends_on: ["10-01"]
files_modified:
  - tests/cli/02-tools-call.bats
  - tests/cli/03-resources.bats
  - tests/cli/04-prompts.bats
autonomous: true

must_haves:
  truths:
    - "tools/call test validates tool execution with arguments"
    - "resources tests validate resource listing and reading"
    - "prompts tests validate prompt listing and retrieval"
    - "Error handling tested (division by zero, missing resources)"
  artifacts:
    - path: "tests/cli/02-tools-call.bats"
      provides: "Tools/call endpoint tests"
      contains: "tools/call"
      min_lines: 40
    - path: "tests/cli/03-resources.bats"
      provides: "Resources endpoints tests"
      contains: "resources/list"
      min_lines: 30
    - path: "tests/cli/04-prompts.bats"
      provides: "Prompts endpoints tests"
      contains: "prompts/list"
      min_lines: 30
  key_links:
    - from: "tests/cli/02-tools-call.bats"
      to: "examples/inspector_server"
      via: "calculate tool execution"
    - from: "tests/cli/03-resources.bats"
      to: "examples/inspector_server"
      via: "resource handlers (file, server info)"
    - from: "tests/cli/04-prompts.bats"
      to: "examples/inspector_server"
      via: "prompt handlers (greeting, code_review)"
---

<objective>
Create advanced endpoint tests for tools/call, resources, and prompts.

Purpose: Complete the MCP endpoint test coverage by testing tool execution with arguments, resource listing/reading, and prompt listing/retrieval. These tests validate the full functionality of the inspector_server implementation.

Output: tests/cli/02-tools-call.bats, 03-resources.bats, 04-prompts.bats test files
</objective>

<execution_context>
@/home/kotdath/.claude/get-shit-done/workflows/execute-plan.md
@/home/kotdath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-automated-cli-testing/10-RESEARCH.md
@.planning/phases/10-automated-cli-testing/10-01-SUMMARY.md
@.planning/phases/09-inspector-server-integration/09-03-SUMMARY.md

# Phase 09-03 Context
inspector_server.cpp implements:
- Tools: calculate (with arithmetic operations), echo, get_time, server_info
- Resources: file://tmp/mcpp_test.txt, info://server
- Prompts: code_review (with language, focus args), greeting (with name arg)

# Phase 10-01 Context
common-setup.sh provides environment configuration for all tests
</context>

<tasks>

<task type="auto">
  <name>Create 02-tools-call.bats for tools/call endpoint</name>
  <files>tests/cli/02-tools-call.bats</files>
  <action>
    Create tests/cli/02-tools-call.bats with the following tests:

    1. Test: "tools/call with calculate tool returns correct result"
       - Send initialize, then tools/call with name="calculate" and arguments {operation: "add", a: 5, b: 3}
       - Verify response contains content array
       - Verify result text contains "8" (5+3)
       - Use jq -e '.result.content[0].text | contains("8")'

    2. Test: "tools/call with multiply operation"
       - Send initialize, then tools/call with operation="multiply", a=4, b=3
       - Verify result contains "12"

    3. Test: "tools/call division by zero returns error"
       - Send initialize, then tools/call with operation="divide", a=5, b=0
       - Verify response contains isError=true
       - Verify error message mentions "division by zero"
       - Use jq -e '.result.isError == true'

    4. Test: "tools/call with echo tool"
       - Send initialize, then tools/call with name="echo", arguments {text: "hello"}
       - Verify result text contains "Echo: hello"

    5. Test: "tools/call with unknown tool returns error"
       - Send initialize, then tools/call with name="unknown_tool"
       - Verify error response (code -32601 or similar)

    6. Test: "tools/call with invalid arguments"
       - Send initialize, then tools/call with name="calculate" but missing required arguments
       - Verify error response or graceful failure

    Follow the same patterns as 05-initialize.bats:
    - Load common-setup in setup()
    - Use run bash -c for piped commands
    - Use jq for JSON extraction and validation
    - Use assert_success, assert_output, assert_equal

    Reference RESEARCH.md Code Examples section.
  </action>
  <verify>
    1. File exists with at least 5 @test blocks
    2. File tests tools/call specifically
    3. File validates calculate tool with arithmetic operations
    4. File tests error cases (division by zero, unknown tool)
  </verify>
  <done>
    - 02-tools-call.bats created with 6 tests covering tools/call endpoint
    - Tests cover all 4 tools (calculate, echo, get_time, server_info)
    - Error handling tested (division by zero, invalid tool, missing arguments)
  </done>
</task>

<task type="auto">
  <name>Create 03-resources.bats and 04-prompts.bats</name>
  <files>tests/cli/03-resources.bats tests/cli/04-prompts.bats</files>
  <action>
    Create tests/cli/03-resources.bats with the following tests:

    1. Test: "resources/list returns registered resources"
       - Send initialize, then resources/list
       - Verify "file://tmp/mcpp_test.txt" exists
       - Verify "info://server" exists
       - Use jq -e '.result.resources[] | select(.uri == "info://server")'

    2. Test: "resources/list resources have metadata"
       - Send initialize, then resources/list
       - Verify resources have name and description
       - Verify MIME types are correct

    3. Test: "resources/read for server info resource"
       - Send initialize, then resources/read with uri="info://server"
       - Verify content is returned
       - Verify JSON content has server information

    Create tests/cli/04-prompts.bats with the following tests:

    1. Test: "prompts/list returns registered prompts"
       - Send initialize, then prompts/list
       - Verify "code_review" prompt exists
       - Verify "greeting" prompt exists

    2. Test: "prompts/list prompts have arguments"
       - Send initialize, then prompts/list
       - Verify code_review has language and focus arguments
       - Verify greeting has name argument

    3. Test: "prompts/get for greeting prompt"
       - Send initialize, then prompts/get with name="greeting", arguments {name: "Claude"}
       - Verify messages array is returned
       - Verify message contains "Hello, Claude!"

    4. Test: "prompts/get for code_review prompt"
       - Send initialize, then prompts/get with name="code_review", arguments {language: "C++", focus: "performance"}
       - Verify messages array is returned
       - Verify prompt template contains requested language and focus

    Follow the same patterns as other test files:
    - Load common-setup in setup()
    - Use run bash -c for piped commands
    - Use jq for JSON validation
    - Use assert_success and assert_output

    Reference RESEARCH.md Code Examples section.
  </action>
  <verify>
    1. Both files exist
    2. 03-resources.bats contains at least 3 @test blocks
    3. 04-prompts.bats contains at least 4 @test blocks
    4. Both files load common-setup
    5. Both files use jq for JSON validation
  </verify>
  <done>
    - 03-resources.bats created with 3 tests covering resources/list and resources/read
    - 04-prompts.bats created with 4 tests covering prompts/list and prompts/get
    - All endpoint tests follow consistent patterns
  </done>
</task>

</tasks>

<verification>
After completing this plan:
1. All three .bats files exist in tests/cli/
2. 02-tools-call.bats has >= 5 tests
3. 03-resources.bats has >= 3 tests
4. 04-prompts.bats has >= 4 tests
5. Total endpoint coverage: tools/list, tools/call, resources/list, resources/read, prompts/list, prompts/get
</verification>

<success_criteria>
1. tools/call tests validate tool execution with arguments
2. Resources tests validate resource listing and reading
3. Prompts tests validate prompt listing and retrieval with arguments
4. Error cases tested (division by zero, unknown resources, missing prompts)
</success_criteria>

<output>
After completion, create `.planning/phases/10-automated-cli-testing/10-03-SUMMARY.md`
</output>
