---
phase: 07-build-validation
plan: 05
type: execute
wave: 3
depends_on: [07-01, 07-02, 07-03, 07-04]
files_modified:
  - src/mcpp/**/*.h
  - src/mcpp/**/*.cpp
  - LICENSE
  - README.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "All source files have MIT license headers"
    - "Library consumer can build, test, and install the project following README instructions"
    - "README documents project setup, usage, and examples"
    - "LICENSE file exists with MIT license text"
  artifacts:
    - path: "LICENSE"
      provides: "MIT license file"
      contains: "MIT License"
    - path: "README.md"
      provides: "Project documentation"
      contains: "mcpp", "Model Context Protocol", "Building"
    - path: "src/mcpp/"
      provides: "All source files with MIT headers"
      contains: "Copyright (c)"
  key_links:
    - from: "README.md"
      to: "CMakeLists.txt"
      via: "Build instructions"
      pattern: "cmake.*build"
    - from: "README.md"
      to: "examples/inspector_server.cpp"
      via: "Example documentation"
      pattern: "inspector|example"
---

<objective>
Add MIT license headers to all source files, verify LICENSE file exists, and create comprehensive README documentation.

Purpose: Complete legal compliance (BUILD-04) and provide user-friendly documentation for building and using the library.

Output: All source files with MIT headers, complete LICENSE file, and README with build/usage instructions.
</objective>

<execution_context>
@/home/kotdath/.claude/get-shit-done/workflows/execute-plan.md
@/home/kotdath/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/07-build-validation/07-CONTEXT.md
@.planning/phases/07-build-validation/07-RESEARCH.md
@.planning/phases/07-build-validation/07-01-SUMMARY.md
@.planning/phases/07-build-validation/07-02-SUMMARY.md
@.planning/phases/07-build-validation/07-03-SUMMARY.md
@.planning/phases/07-build-validation/07-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Check all source files for MIT license headers</name>
  <files>src/mcpp/**/*.h, src/mcpp/**/*.cpp</files>
  <action>
Audit all source files for MIT license headers:

1. List all source files:
   ```bash
   find src/mcpp -type f \( -name "*.h" -o -name "*.cpp" \) | sort
   ```

2. Check each file for MIT license header pattern:
   - Must start with: `// mcpp - MCP C++ library`
   - Include: `Copyright (c)` line
   - Include: `Distributed under MIT License`
   - Include full MIT license text or reference

3. Generate list of files missing headers:
   ```bash
   for f in $(find src/mcpp -type f \( -name "*.h" -o -name "*.cpp" \)); do
       if ! head -30 "$f" | grep -q "MIT License"; then
           echo "$f"
       fi
   done
   ```

Do NOT modify files yet - just audit.
  </action>
  <verify>List of files missing MIT license headers generated</verify>
  <done>Audit complete - identified files needing license headers</done>
</task>

<task type="auto">
  <name>Add MIT license headers to files missing them</name>
  <files>src/mcpp/**/*.h, src/mcpp/**/*.cpp</files>
  <action>
For each file identified in the audit, add the MIT license header:

The standard header format (matches existing files):
```cpp
// mcpp - MCP C++ library
// https://github.com/mcpp-project/mcpp
//
// Copyright (c) 2025 mcpp contributors
// Distributed under MIT License
//
// Permission is hereby granted, free of charge, to any person obtaining a copy
// of this software and associated documentation files (the "Software"), to deal
// in the Software without restriction, including without limitation the rights
// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
// copies of the Software, and to permit persons to whom the Software is
// furnished to do so, subject to the following conditions:
//
// The above copyright notice and this permission notice shall be included in all
// copies or substantial portions of the Software.
//
// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
// SOFTWARE.
```

For header files (.h), add after the license block:
```cpp
#ifndef [INCLUDE_GUARD]
#define [INCLUDE_GUARD]

// Existing file content...
```

For source files (.cpp), add after the license block:
```cpp
#include "existing/includes.h"

// Existing file content...
```

Apply to each file missing the header. Preserve all existing content, just add the header at the top.
  </action>
  <verify>All source files have MIT license headers at the top of the file</verify>
  <done>MIT license headers added to all source files</done>
</task>

<task type="auto">
  <name>Verify LICENSE file exists and is complete</name>
  <files>LICENSE</files>
  <action>
Check if LICENSE file exists and has correct MIT license text:

1. Check if file exists:
   ```bash
   cat LICENSE
   ```

2. If missing or incomplete, create LICENSE with:
```
MIT License

Copyright (c) 2025 mcpp contributors

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
```
  </action>
  <verify>LICENSE file exists with complete MIT license text</verify>
  <done>LICENSE file verified/created with MIT license</done>
</task>

<task type="auto">
  <name>Create comprehensive README.md</name>
  <files>README.md</files>
  <action>
Create or update README.md with:

```markdown
# mcpp - MCP C++ Library

A modern C++ library for building Model Context Protocol (MCP) clients and servers. Provides full MCP 2025-11-25 spec coverage with all transports, fast JSON-RPC handling, and minimal blocking operations.

## Features

- **Full MCP 2025-11-25 spec support**: Tools, resources, prompts, logging, sampling, roots, progress, cancellations, streaming
- **Multiple transports**: stdio and Streamable HTTP (SSE)
- **Fast and correct**: JSON-RPC 2.0 compliant with minimal blocking operations
- **Thread-safe**: All public methods safe to call from any thread
- **Layered API**: Low-level callback core + high-level RAII wrappers
- **Permissive license**: MIT for both static and shared library distribution

## Requirements

- C++20 compiler (gcc-11+, clang-12+, MSVC 2019+)
- CMake 3.16+
- nlohmann/json 3.11+ (included in third_party/)
- spdlog 1.8+ (optional, for logging)

## Building

### Quick Start

```bash
# Clone the repository
git clone https://github.com/mcpp-project/mcpp.git
cd mcpp

# Configure and build
cmake -B build -DCMAKE_BUILD_TYPE=Release
cmake --build build

# Run tests
ctest --test-dir build --output-on-failure

# Install (optional)
cmake --install build --prefix /usr/local
```

### Build Options

```bash
# Build static library only
cmake -B build -DBUILD_SHARED_LIBS=OFF

# Disable tests
cmake -B build -DMCPP_BUILD_TESTS=OFF

# Disable examples
cmake -B build -DMCPP_BUILD_EXAMPLES=OFF

# Debug build with sanitizers
cmake -B build -DCMAKE_BUILD_TYPE=Debug \
      -DCMAKE_CXX_FLAGS="-fsanitize=address -fsanitize=leak -g"
```

## Usage

### Basic Server

```cpp
#include "mcpp/server/mcp_server.h"
#include "mcpp/transport/stdio_transport.h"

int main() {
    auto transport = std::make_unique<StdioTransport>();
    mcpp::server::McpServer server(std::move(transport));

    // Register a tool
    server.get_tool_registry().register_tool(
        "calculate",
        {{"description", "Perform calculations"}},
        [](const nlohmann::json& params) {
            double a = params["a"];
            double b = params["b"];
            return mcpp::server::ToolResult{
                {"content", nlohmann::json::array({{
                    {"type", "text"},
                    {"text", std::to_string(a + b)}
                }})}
            };
        }
    );

    // Run server
    server.run();
    return 0;
}
```

### Basic Client

```cpp
#include "mcpp/client.h"
#include "mcpp/transport/stdio_transport.h"

int main() {
    auto transport = std::make_unique<StdioTransport>();
    mcpp::McpClient client(std::move(transport));

    // Set message handler
    client.set_notification_handler([](const nlohmann::json& notification) {
        std::cout << "Received: " << notification.dump(2) << std::endl;
    });

    // Initialize
    auto init_result = client.initialize({
        {"protocolVersion", "2025-11-25"},
        {"capabilities", nlohmann::json::object()},
        {"clientInfo", {{"name", "my_client"}, {"version", "1.0"}}}
    });

    // Call a tool
    auto result = client.call_tool("calculate", {{"a", 5}, {"b", 3}});

    return 0;
}
```

## Examples

### Inspector Server

An example MCP server for testing with MCP Inspector:

```bash
# Build the example
cmake --build build --target inspector_server

# Run with MCP Inspector
mcp-inspector connect stdio ./build/examples/inspector_server
```

The inspector server demonstrates:
- Tool registration (calculate, echo, get_time)
- Resource serving (file reading, server info)
- Prompt templates (greeting, code review)

## Testing

```bash
# Run all tests
ctest --test-dir build

# Run specific test suites
ctest --test-dir build -L unit      # Unit tests only
ctest --test-dir build -L integration  # Integration tests only
ctest --test-dir build -L compliance   # JSON-RPC compliance tests

# Run with verbose output
ctest --test-dir build --verbose

# Run specific test
./build/tests/mcpp_unit_tests --gtest_filter="JsonRpcRequest.*"
```

### Sanitizer Testing

```bash
# AddressSanitizer + LeakSanitizer
cmake -B build/sanitizer -DCMAKE_BUILD_TYPE=Debug \
      -DCMAKE_CXX_FLAGS="-fsanitize=address -fsanitize=leak -fno-omit-frame-pointer -g" \
      -DCMAKE_EXE_LINKER_FLAGS="-fsanitize=address -fsanitize=leak"
cmake --build build/sanitizer
ctest --test-dir build/sanitizer

# ThreadSanitizer (separate build)
cmake -B build/tsan -DCMAKE_BUILD_TYPE=Debug \
      -DCMAKE_CXX_FLAGS="-fsanitize=thread -g" \
      -DCMAKE_EXE_LINKER_FLAGS="-fsanitize=thread"
cmake --build build/tsan
ctest --test-dir build/tsan
```

## Installation

```bash
# Install to system (requires sudo)
sudo cmake --install build --prefix /usr/local

# Install to custom location
cmake --install build --prefix $HOME/.local

# Use in CMake project
find_package(mcpp REQUIRED)
target_link_libraries(my_app PRIVATE mcpp::mcpp)
```

## Project Structure

```
mcpp/
├── CMakeLists.txt          # Root build configuration
├── LICENSE                 # MIT license
├── README.md               # This file
├── src/
│   └── mcpp/              # Public headers
│       ├── api/           # High-level API
│       ├── async/         # Callback types and timeout
│       ├── client/        # Client implementation
│       ├── core/          # JSON-RPC and request tracking
│       ├── content/       # Content types and pagination
│       ├── protocol/      # MCP protocol types
│       ├── server/        # Server implementation
│       ├── transport/     # Transport layer
│       └── util/          # Utilities (logging, retry, etc.)
├── tests/
│   ├── unit/             # Unit tests
│   ├── integration/      # Integration tests
│   ├── compliance/       # JSON-RPC spec tests
│   └── fixtures/         # Test utilities
├── examples/             # Example programs
└── third_party/          # Vendored dependencies
```

## License

MIT License - see [LICENSE](LICENSE) file for details.

## Contributing

Contributions are welcome! Please:

1. Fork the repository
2. Create a feature branch
3. Add tests for new functionality
4. Ensure all tests pass
5. Submit a pull request

## Resources

- [MCP Specification](https://modelcontextprotocol.io)
- [MCP Inspector](https://github.com/modelcontextprotocol/inspector)
- [JSON-RPC 2.0 Specification](https://www.jsonrpc.org/specification)

## Status

This project is in active development. Version 0.1.0-alpha targets full MCP 2025-11-25 spec support.
```
  </action>
  <verify>README.md exists with comprehensive documentation</verify>
  <done>README.md created with build instructions, usage examples, and project documentation</done>
</task>

<task type="auto">
  <name>Verify build from README instructions</name>
  <files>README.md, CMakeLists.txt</files>
  <action>
Test that the README instructions actually work:

1. Clean build from scratch:
   ```bash
   rm -rf build
   cmake -B build -DCMAKE_BUILD_TYPE=Release
   cmake --build build
   ```

2. Run tests as documented:
   ```bash
   ctest --test-dir build --output-on-failure
   ```

3. Test labeled test runs:
   ```bash
   ctest --test-dir build -L unit
   ctest --test-dir build -L integration
   ```

4. Verify example builds:
   ```bash
   cmake --build build --target inspector_server
   ```

5. Verify install works:
   ```bash
   cmake --install build --prefix /tmp/mcpp-install-test
   ls /tmp/mcpp-install-test/lib/
   ls /tmp/mcpp-install_test/include/mcpp/
   rm -rf /tmp/mcpp-install-test
   ```

Do NOT commit - verification only.
  </action>
  <verify>
All README instructions work:
- Clean build succeeds
- Tests run successfully
- Examples build
- Install command works
  </verify>
  <done>README instructions validated - project can be built and installed from scratch using documentation</done>
</task>

<task type="auto">
  <name>Final verification of all Phase 7 requirements</name>
  <files>CMakeLists.txt, tests/, examples/, README.md, LICENSE</files>
  <action>
Run comprehensive final verification:

1. Verify BUILD-01 (CMake build system):
   ```bash
   cmake -B build -DCMAKE_BUILD_TYPE=Release
   cmake --build build
   ```
   Expected: Clean build with no errors

2. Verify BUILD-02 (static library):
   ```bash
   ls -la build/src/libmcpp.a
   ```
   Expected: Static library exists

3. Verify BUILD-03 (shared library with SONAME):
   ```bash
   ls -la build/src/libmcpp.so*
   readelf -d build/src/libmcpp.so | grep SONAME
   ```
   Expected: libmcpp.so.0.1.0, libmcpp.so.0, libmcpp.so with correct SONAME

4. Verify BUILD-04 (MIT license headers):
   ```bash
   for f in $(find src/mcpp -type f \( -name "*.h" -o -name "*.cpp" \)); do
       head -30 "$f" | grep -q "MIT License" || echo "Missing: $f"
   done
   ```
   Expected: No output (all files have MIT headers)

5. Verify TEST-01 (Google Test integration):
   ```bash
   ctest --test-dir build -L unit --output-on-failure
   ```
   Expected: All unit tests pass

6. Verify TEST-02 (MCP Inspector integration):
   ```bash
   ls -la build/examples/inspector_server
   ```
   Expected: inspector_server executable exists

7. Verify TEST-03 (JSON-RPC compliance tests):
   ```bash
   ctest --test-dir build -L compliance --output-on-failure
   ```
   Expected: All compliance tests pass

8. Verify TEST-04 (Thread safety - sanitizer setup documented):
   ```bash
   grep -A5 "ThreadSanitizer" README.md
   ```
   Expected: README documents TSan testing

9. Verify TEST-05 (Async lifetime - sanitizer setup documented):
   ```bash
   grep -A5 "AddressSanitizer" README.md
   ```
   Expected: README documents ASan/LSan testing

10. Verify install and find_package:
    ```bash
    cmake --install build --prefix /tmp/mcpp-final-test
    cmake -B /tmp/mcpp-consumer -DCMAKE_PREFIX_PATH=/tmp/mcpp-final-test \
          -DCMAKE_PROJECT_NAME=mcpp-consumer -DCMAKE_PROJECT_TOP_LEVEL_INCLUDE=try_compile.cmake
    rm -rf /tmp/mcpp-final-test /tmp/mcpp-consumer
    ```

Document any failures or issues in the SUMMARY.
  </action>
  <verify>
All 9 requirements (BUILD-01 to BUILD-04, TEST-01 to TEST-05) verified:
- Build system works
- Static and shared libraries built
- MIT headers present
- Tests pass (unit, integration, compliance)
- Sanitizers documented
- Install/find_package works
  </verify>
  <done>Phase 7 requirements fully verified - all BUILD and TEST requirements satisfied</done>
</task>

</tasks>

<verification>
After all tasks complete, verify:
1. All source files in src/mcpp/ have MIT license headers
2. LICENSE file exists with complete MIT license text
3. README.md has build instructions, usage examples, testing guide
4. Following README instructions results in working build
5. All Phase 7 requirements (BUILD-01 to BUILD-04, TEST-01 to TEST-05) satisfied
</verification>

<success_criteria>
1. 100% of source files have MIT license headers
2. LICENSE file exists with correct MIT license text
3. README.md documents building, usage, testing, installation
4. README instructions work for fresh clone
5. All BUILD and TEST requirements verified
</success_criteria>

<output>
After completion, create `.planning/phases/07-build-validation/07-05-SUMMARY.md` with:
- MIT license header status for all files
- LICENSE file verification
- README.md contents
- Final verification results for all Phase 7 requirements
- Phase 7 completion status
</output>
