# Milestone v1.1: Stability & Inspector Integration

**Status:** ✅ SHIPPED 2026-02-01
**Phases:** 8-11
**Total Plans:** 13

## Overview

mcpp v1.1 is a focused stabilization milestone fixing the critical JSON-RPC parse error bug (-32700) and enabling proper testing via MCP Inspector CLI integration. The work follows a clear dependency chain: fix library layer first, update example server to use fixes, add automated tests to prevent regression, and document the new testing capabilities.

## Phases

### Phase 8: Bug Fix Foundation

**Goal**: Library provides proper JSON-RPC request validation and stdio protocol compliance
**Depends on**: Phase 7 (v1.0 complete)
**Requirements**: BUGFIX-01, BUGFIX-02, BUGFIX-03
**Success Criteria** (what must be TRUE):
  1. Library provides JsonRpcRequest::from_json() for proper request validation
  2. All JSON output includes trailing newline delimiter for stdio compliance
  3. Debug output goes to stderr, not stdout (prevents protocol pollution)
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md — Implement JsonRpcRequest::from_json() validation with ParseError diagnostics
- [x] 08-02-PLAN.md — Add newline-delimited output helpers and stderr-only debug logging macro

**Details:**
Phase 8 delivered core library fixes for JSON-RPC validation and stdio protocol compliance. Added `JsonRpcRequest::from_json()` with comprehensive ParseError diagnostics (8 error codes), `to_string_delimited()` methods for all JSON-RPC types, and `MCPP_DEBUG_LOG` macro for stderr-only debug output.

### Phase 9: Inspector Server Integration

**Goal**: Example server uses new validation layer and is compatible with MCP Inspector
**Depends on**: Phase 8
**Requirements**: BUGFIX-04, BUGFIX-05, INSPECT-01, INSPECT-02, INSPECT-03, INSPECT-04
**Success Criteria** (what must be TRUE):
  1. Example server uses JsonRpcRequest::from_json() for request parsing
  2. Parse error responses include properly extracted request ID
  3. mcp.json configuration enables standard Inspector compatibility
  4. Manual testing with MCP Inspector CLI succeeds (tools/call works)
**Plans**: 3 plans

Plans:
- [x] 09-01-PLAN.md — Add JsonRpcRequest::extract_request_id() helper for parse error responses
- [x] 09-02-PLAN.md — Update inspector_server.cpp to use from_json() validation layer
- [x] 09-03-PLAN.md — Create mcp.json configuration and TESTING.md documentation

**Details:**
Phase 9 integrated the bug fixes into the example server for MCP Inspector compatibility. Added `extract_request_id()` helper for malformed JSON, updated inspector_server main loop with `from_json()` validation, created `mcp.json` configuration, and documented manual Inspector testing in TESTING.md (examples/ directory).

### Phase 10: Automated CLI Testing

**Goal**: Bats-core test suite validates all MCP methods via Inspector
**Depends on**: Phase 9
**Requirements**: TEST-01, TEST-02, TEST-03, TEST-04, TEST-05, TEST-06
**Success Criteria** (what must be TRUE):
  1. Bats-core 1.11.0+ test framework integrated with CMake
  2. Basic integration tests pass (tools/list, tools/call, resources/list, prompts/list)
  3. JSON responses validated using jq
  4. Server lifecycle helpers (startup, shutdown, cleanup) prevent process leaks
  5. CI/CD runs cli-tests target as part of test suite
**Plans**: 6 plans (4 original + 2 gap closure)

Plans:
- [x] 10-01-PLAN.md — Set up bats-core Git submodules and common setup helper
- [x] 10-02-PLAN.md — Create initialize and tools/list endpoint tests
- [x] 10-03-PLAN.md — Create tools/call, resources, and prompts endpoint tests
- [x] 10-04-PLAN.md — Create server lifecycle tests and CMake integration
- [x] 10-05-PLAN.md — Create CI/CD pipeline and fix CMake bats discovery (Gap 1 closure)
- [x] 10-06-PLAN.md — Refactor test files to use common-setup consistently (Gap 2 closure)

**Details:**
Phase 10 built comprehensive automated CLI testing using BATS framework. Created 45 CLI tests covering initialize handshake, tools/list/call, resources/list/read, prompts/list. Integrated with CMake/CTest, created GitHub Actions CI/CD pipeline, closed 2 gaps (CMake BATS discovery, common-setup consistency).

### Phase 11: Documentation

**Goal**: Users can run Inspector tests and write custom integration tests
**Depends on**: Phase 10
**Requirements**: DOCS-01, DOCS-02
**Success Criteria** (what must be TRUE):
  1. README includes MCP Inspector testing instructions
  2. Testing guide explains how to write custom Inspector tests
**Plans**: 2 plans

Plans:
- [x] 11-01-PLAN.md — Update README.md with Inspector Testing section (UI and CLI modes)
- [x] 11-02-PLAN.md — Create TESTING.md with BATS testing guide

**Details:**
Phase 11 completed documentation for Inspector testing. Updated README.md with Inspector Testing section (ASCII stdio flow diagram, UI/CLI mode examples, Quick Start integration), created TESTING.md at project root with comprehensive BATS testing guide (506 lines, code-first walkthrough, 5 common patterns, 8-entry troubleshooting FAQ).

---

## Milestone Summary

**Key Decisions:**
- ParseError messages exclude raw JSON content for security (avoid echoing malicious input)
- ID extraction from malformed requests uses string search (not JSON parsing)
- Null ID (int64_t=0) as universal fallback for request ID extraction failures
- Git submodules for BATS testing framework instead of system packages
- Code-first documentation approach: walkthrough existing tests before teaching template

**Issues Resolved:**
- JSON-RPC parse error (-32700) affecting all tool calls — FIXED
- Stdout pollution corrupting JSON-RPC stream — FIXED (MCPP_DEBUG_LOG)
- Missing newline delimiters causing parse errors — FIXED (to_string_delimited)
- Flaky CLI tests due to timing issues — RESOLVED (teardown cleanup)
- CI/CD integration missing — RESOLVED (GitHub Actions workflow)

**Issues Deferred:**
- None — all v1.1 blockers resolved

**Technical Debt Incurred:**
- None significant — focused bug fix milestone with clean implementation

---

_For current project status, see .planning/ROADMAP.md_

---
*Archived: 2026-02-01 as part of v1.1 milestone completion*
